--- 
title: "Dicours Analysis"
author: "Eug√©nie Mathieu, Maeva Marin, Hadrien Renger, Wajma Nazim"
date: "`r format(Sys.time(), '%d %B, %Y')`"
site: bookdown::bookdown_site
output: bookdown::html_document2
documentclass: book
bibliography: [references.bib, packages.bib]
biblio-style: apalike
link-citations: yes
---
```{r include=FALSE, cache=FALSE}
#############################################
## The following loads the needed packages ##
#############################################

# load the required packages
packages <- c(
  "here", "readr",# for the project's organization
  "tidyverse", "lubridate", # for wrangling
  "modelr", "broom",
  "dplyr",# for modeling
  "ggrepel", "gghighlight", "patchwork", "maps", # for plotting
  "knitr", "kableExtra", "bookdown", "rmarkdown", # for the report
  "randomForest","janitor","caret","pdftools","rvest","wordcloud2","tidytext","tokenizers","quanteda","stringr","lexicon","RColorBrewer","tm","printr" )

purrr::walk(packages, library, character.only = TRUE)

# automatically create a bib database for R packages
write_bib(.packages(), here::here("packages.bib"))

######################################################
## The following sets a few option for nice reports ##
######################################################

# general options
options(
  digits = 3,
  str = strOptions(strict.width = "cut"),
  width = 69,
  tibble.width = 69,
  cli.unicode = FALSE
)

# ggplot options
theme_set(theme_light())

# knitr options
opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  fig.retina = 0.8, # figures are either vectors or 300 dpi diagrams
  dpi = 300,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,
  fig.show = "hold",
  message = FALSE,
  echo = FALSE
)

######################################################
## The following sets a few option for nice reports ##
######################################################

pval_star <- function (p, cutoffs = c(0.05, 0.01, 0.001)) {
  stopifnot(length(cutoffs) == 3)
  if (length(p) > 1) {
    sapply(p, pval_star, cutoffs = cutoffs)
  }
  else {
    ifelse(p > cutoffs[1], "", ifelse(p > cutoffs[2], 
                                      " *", 
                                      ifelse(p > cutoffs[3], 
                                             " **", 
                                             " ***")))
  }
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
#############################################
## The following loads the needed packages ##
#############################################

# load the required packages
packages <- c(
  "here", "readr",# for the project's organization
  "tidyverse", "lubridate", # for wrangling
  "modelr", "broom",
  "dplyr",# for modeling
  "ggrepel", "gghighlight", "patchwork", "maps", # for plotting
  "knitr", "kableExtra", "bookdown", "rmarkdown", # for the report
  "randomForest","janitor","caret","pdftools","rvest","wordcloud2","tidytext","tokenizers","quanteda","stringr","lexicon","RColorBrewer","tm","printr" )

purrr::walk(packages, library, character.only = TRUE)

# automatically create a bib database for R packages
write_bib(.packages(), here::here("packages.bib"))

######################################################
## The following sets a few option for nice reports ##
######################################################

# general options
options(
  digits = 3,
  str = strOptions(strict.width = "cut"),
  width = 69,
  tibble.width = 69,
  cli.unicode = FALSE
)

# ggplot options
theme_set(theme_light())

# knitr options
opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  fig.retina = 0.8, # figures are either vectors or 300 dpi diagrams
  dpi = 300,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,
  fig.show = "hold",
  message = FALSE,
  echo = FALSE
)

######################################################
## The following sets a few option for nice reports ##
######################################################

pval_star <- function (p, cutoffs = c(0.05, 0.01, 0.001)) {
  stopifnot(length(cutoffs) == 3)
  if (length(p) > 1) {
    sapply(p, pval_star, cutoffs = cutoffs)
  }
  else {
    ifelse(p > cutoffs[1], "", ifelse(p > cutoffs[2], 
                                      " *", 
                                      ifelse(p > cutoffs[3], 
                                             " **", 
                                             " ***")))
  }
}
```
# Introduction

## Overview and Motivation


## Data loadind

```{r data}
# Boris Johnson's speech of March 16th

boris16mars <- read_html("https://www.gov.uk/government/speeches/pm-statement-on-coronavirus-16-march-2020")%>%            html_nodes(xpath="//*[@id='content']/div[3]/div[1]/div[1]/div[2]/div") %>%
  html_text()

macron <- read_html("https://franceintheus.org/spip.php?article9654") %>%
           html_nodes("div.texte") %>%
          html_text()

```


<!--chapter:end:report/Introduction.Rmd-->

```{r include=FALSE, cache=FALSE}
#############################################
## The following loads the needed packages ##
#############################################

# load the required packages
packages <- c(
  "here", "readr",# for the project's organization
  "tidyverse", "lubridate", # for wrangling
  "modelr", "broom",
  "dplyr",# for modeling
  "ggrepel", "gghighlight", "patchwork", "maps", # for plotting
  "knitr", "kableExtra", "bookdown", "rmarkdown", # for the report
  "randomForest","janitor","caret","pdftools","rvest","wordcloud2","tidytext","tokenizers","quanteda","stringr","lexicon","RColorBrewer","tm","printr" )

purrr::walk(packages, library, character.only = TRUE)

# automatically create a bib database for R packages
write_bib(.packages(), here::here("packages.bib"))

######################################################
## The following sets a few option for nice reports ##
######################################################

# general options
options(
  digits = 3,
  str = strOptions(strict.width = "cut"),
  width = 69,
  tibble.width = 69,
  cli.unicode = FALSE
)

# ggplot options
theme_set(theme_light())

# knitr options
opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  fig.retina = 0.8, # figures are either vectors or 300 dpi diagrams
  dpi = 300,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,
  fig.show = "hold",
  message = FALSE,
  echo = FALSE
)

######################################################
## The following sets a few option for nice reports ##
######################################################

pval_star <- function (p, cutoffs = c(0.05, 0.01, 0.001)) {
  stopifnot(length(cutoffs) == 3)
  if (length(p) > 1) {
    sapply(p, pval_star, cutoffs = cutoffs)
  }
  else {
    ifelse(p > cutoffs[1], "", ifelse(p > cutoffs[2], 
                                      " *", 
                                      ifelse(p > cutoffs[3], 
                                             " **", 
                                             " ***")))
  }
}
```


```{r load myData, include=FALSE}
load("data.RData")
```



## Test avec le whole set de Boris
```{r echo=FALSE,warning=FALSE, message=FALSE,cache=TRUE}
devtools::install_github("dgrtwo/drlib")
```

```{r fig= "15 most common words in Boris Johnson's speech on March 16th", echo = FALSE}
boris16mars_dtm <- VectorSource(boris16mars) %>% VCorpus() %>%  DocumentTermMatrix(control=list(removePunctuation=TRUE, removeNumbers=TRUE, stopwords=TRUE))
boris16mars_tidy <- tidy(boris16mars_dtm)
boris16mars_tidy %>%
  group_by(document) %>%
  top_n(15) %>%
  ungroup() %>%
  mutate(document = factor(as.numeric(document), levels = 1:17)) %>%
  ggplot(aes(drlib::reorder_within(term, count, document), count, fill =term)) +
  theme(legend.position = "none") +
  ggtitle("15 most common words in Boris Johnson's speech on March 16th") +
  xlab("Word") + ylab("Frequency") +
  geom_bar(stat = "identity") +
  drlib::scale_x_reordered() +
  coord_flip() +
  facet_wrap(~ document, scales = "free")
```



## tokenization of the speech of Boris Johnson
```{r Boris tokenization and frequency, echo = FALSE}
boris <- tibble(txt = boris16mars)

boris16mars.fr<- boris %>% unnest_tokens(word, txt) %>%
  anti_join(stop_words, by = "word") %>%group_by(word) %>% summarize(Count =n()) %>% 
  arrange(desc(Count)) 
boris %>%
  unnest_tokens(word, txt) %>%
  anti_join(stop_words, by = "word") %>%group_by(word) %>% summarize(Count =n()) %>% 
  arrange(desc(Count)) %>%
  kable() %>% kable_styling()

```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r Full spring speech Boris Cleaning and DTM, echo=FALSE}
BORIS.cp <- VCorpus(VectorSource(BORIS))

BORIS.cp <- tm_map(BORIS.cp, removePunctuation) 
BORIS.cp <- tm_map(BORIS.cp, removeNumbers)
BORIS.cp <- tm_map(BORIS.cp, removeWords, stopwords("english"))
BORIS.cp <- tm_map(BORIS.cp, content_transformer(tolower))
BORIS.cp <- tm_map(BORIS.cp, stripWhitespace)
BORIS.dtm <- DocumentTermMatrix(BORIS.cp) %>% tidy()
BORIS.tfidf <- DocumentTermMatrix(BORIS.cp, control = list(weighting = weightTfIdf))
inspect(BORIS.tfidf)
```

```{r Full spring speech Boris Cloud, echo=FALSE}
BORISquanteda.cp <- corpus(BORIS)
BORISquanteda.tk <- tokens(BORISquanteda.cp, remove_numbers=TRUE, remove_punct=TRUE, remove_symbols=TRUE, remove_separators=TRUE) %>% tokens_tolower() %>% tokens_remove(stopwords("english"))
BORISquanteda.dfm <- dfm(BORISquanteda.tk)
BORISquanteda.tfidf <- dfm_tfidf(BORISquanteda.dfm)
textplot_wordcloud(BORISquanteda.tfidf)

```


```{r Full spring speech Boris Zipfs Law, echo=FALSE}
BORIS.freq <- textstat_frequency(BORISquanteda.dfm)

BORIS.freq %>% ggplot(aes(x= rank , y= frequency))+
  geom_point() +
  geom_text(aes(label=ifelse(frequency>24,as.character(feature),'')),hjust=-1,vjust=0) +
  ggtitle("Zipf's law applied on speeches of Boris Johnson related to \ncovid-19 in between March 9th and 22nd") +
  xlab("Rank of words among documents") + 
    ylab("Frequency of the terms")


```

```{r BORIS All speeches Sentiment plot, echo=FALSE}
summary(BORISquanteda.cp)
library(lexicon) 
BORISquanteda.dfm
BORISquanteda.tk %>% tokens_lookup(dictionary = data_dictionary_LSD2015) %>% 
  dfm() %>% 
  tidy() %>% 
  ggplot(aes(x=document, y=count, fill=term)) + 
  geom_bar(stat="identity") + 
  coord_flip() +
  geom_text(aes(label = count), size = 3, hjust = 5, vjust = 0, position =     "stack")
```





<!--chapter:end:report/EDA_John.Rmd-->

```{r include=FALSE, cache=FALSE}
#############################################
## The following loads the needed packages ##
#############################################

# load the required packages
packages <- c(
  "here", "readr",# for the project's organization
  "tidyverse", "lubridate", # for wrangling
  "modelr", "broom",
  "dplyr",# for modeling
  "ggrepel", "gghighlight", "patchwork", "maps", # for plotting
  "knitr", "kableExtra", "bookdown", "rmarkdown", # for the report
  "randomForest","janitor","caret","pdftools","rvest","wordcloud2","tidytext","tokenizers","quanteda","stringr","lexicon","RColorBrewer","tm","printr" )

purrr::walk(packages, library, character.only = TRUE)

# automatically create a bib database for R packages
write_bib(.packages(), here::here("packages.bib"))

######################################################
## The following sets a few option for nice reports ##
######################################################

# general options
options(
  digits = 3,
  str = strOptions(strict.width = "cut"),
  width = 69,
  tibble.width = 69,
  cli.unicode = FALSE
)

# ggplot options
theme_set(theme_light())

# knitr options
opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  fig.retina = 0.8, # figures are either vectors or 300 dpi diagrams
  dpi = 300,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,
  fig.show = "hold",
  message = FALSE,
  echo = FALSE
)

######################################################
## The following sets a few option for nice reports ##
######################################################

pval_star <- function (p, cutoffs = c(0.05, 0.01, 0.001)) {
  stopifnot(length(cutoffs) == 3)
  if (length(p) > 1) {
    sapply(p, pval_star, cutoffs = cutoffs)
  }
  else {
    ifelse(p > cutoffs[1], "", ifelse(p > cutoffs[2], 
                                      " *", 
                                      ifelse(p > cutoffs[3], 
                                             " **", 
                                             " ***")))
  }
}
```
#Wajma

```{r}

# Data Acquisition
corpus_macron <- read_html("https://franceintheus.org/spip.php?article9654") %>%
  html_nodes("div.texte") %>%
  html_text()
str_replace_all(corpus_macron,"[\r\n\t]", "")

# EDA
## Tokenization
corpus_macron <- corpus(corpus_macron)
summary(corpus_macron) ###number of tokens and token types
corpus_macron_0 <- tokens(corpus_macron, remove_numbers = TRUE, remove_punct = TRUE, remove_symbols = TRUE, remove_separators = TRUE)
## Lemmatization
corpus_macron_1 <- tokens_replace(corpus_macron_0, pattern=hash_lemmas$token, replacement = hash_lemmas$lemma)
## Cleaning
corpus_macron_2=corpus_macron_1 %>% 
  tokens_tolower() %>% 
  tokens_remove(stopwords("english")) 
## Document-Term Matrix DTM
corpus_macron.dfm <- dfm(corpus_macron_2)
View(corpus_macron.dfm)
## TFIDF no point when just on document, maybe add when combining texts
#corpus_macron.tfidf <- dfm_tfidf(corpus_macron.dfm)
#View(corpus_macron.tfidf)
## Cloud of Words
textplot_wordcloud(corpus_macron.dfm, colors=brewer.pal(8, "Dark2"))
## Lexical Divesity Token Type Ratio TTR
N <- ntoken(corpus_macron_2)
V <- ntype(corpus_macron_2)
TTR <- V/N
TTR ###the text is quite poor, as TTR is of 0.4
## Zipf's Law
corpus_macron_freq <- textstat_frequency(corpus_macron.dfm)
plot(frequency~rank, data=corpus_macron_freq, pch=20)
ggplot(corpus_macron_freq,aes(x = rank, y = frequency, label=feature)) + geom_point(size=2, alpha =1) + theme_bw() + geom_text(aes(label=feature),hjust=0, vjust=0) + xlim(0,20)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

<!--chapter:end:report/EDA_Macron.rmd-->

```{r include=FALSE, cache=FALSE}
#############################################
## The following loads the needed packages ##
#############################################

# load the required packages
packages <- c(
  "here", "readr",# for the project's organization
  "tidyverse", "lubridate", # for wrangling
  "modelr", "broom",
  "dplyr",# for modeling
  "ggrepel", "gghighlight", "patchwork", "maps", # for plotting
  "knitr", "kableExtra", "bookdown", "rmarkdown", # for the report
  "randomForest","janitor","caret","pdftools","rvest","wordcloud2","tidytext","tokenizers","quanteda","stringr","lexicon","RColorBrewer","tm","printr" )

purrr::walk(packages, library, character.only = TRUE)

# automatically create a bib database for R packages
write_bib(.packages(), here::here("packages.bib"))

######################################################
## The following sets a few option for nice reports ##
######################################################

# general options
options(
  digits = 3,
  str = strOptions(strict.width = "cut"),
  width = 69,
  tibble.width = 69,
  cli.unicode = FALSE
)

# ggplot options
theme_set(theme_light())

# knitr options
opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  fig.retina = 0.8, # figures are either vectors or 300 dpi diagrams
  dpi = 300,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,
  fig.show = "hold",
  message = FALSE,
  echo = FALSE
)

######################################################
## The following sets a few option for nice reports ##
######################################################

pval_star <- function (p, cutoffs = c(0.05, 0.01, 0.001)) {
  stopifnot(length(cutoffs) == 3)
  if (length(p) > 1) {
    sapply(p, pval_star, cutoffs = cutoffs)
  }
  else {
    ifelse(p > cutoffs[1], "", ifelse(p > cutoffs[2], 
                                      " *", 
                                      ifelse(p > cutoffs[3], 
                                             " **", 
                                             " ***")))
  }
}
```

# Conclusion


<!--chapter:end:report/Conclusion.Rmd-->

```{r include=FALSE, cache=FALSE}
#############################################
## The following loads the needed packages ##
#############################################

# load the required packages
packages <- c(
  "here", "readr",# for the project's organization
  "tidyverse", "lubridate", # for wrangling
  "modelr", "broom",
  "dplyr",# for modeling
  "ggrepel", "gghighlight", "patchwork", "maps", # for plotting
  "knitr", "kableExtra", "bookdown", "rmarkdown", # for the report
  "randomForest","janitor","caret","pdftools","rvest","wordcloud2","tidytext","tokenizers","quanteda","stringr","lexicon","RColorBrewer","tm","printr" )

purrr::walk(packages, library, character.only = TRUE)

# automatically create a bib database for R packages
write_bib(.packages(), here::here("packages.bib"))

######################################################
## The following sets a few option for nice reports ##
######################################################

# general options
options(
  digits = 3,
  str = strOptions(strict.width = "cut"),
  width = 69,
  tibble.width = 69,
  cli.unicode = FALSE
)

# ggplot options
theme_set(theme_light())

# knitr options
opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  fig.retina = 0.8, # figures are either vectors or 300 dpi diagrams
  dpi = 300,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = 0.618,
  fig.show = "hold",
  message = FALSE,
  echo = FALSE
)

######################################################
## The following sets a few option for nice reports ##
######################################################

pval_star <- function (p, cutoffs = c(0.05, 0.01, 0.001)) {
  stopifnot(length(cutoffs) == 3)
  if (length(p) > 1) {
    sapply(p, pval_star, cutoffs = cutoffs)
  }
  else {
    ifelse(p > cutoffs[1], "", ifelse(p > cutoffs[2], 
                                      " *", 
                                      ifelse(p > cutoffs[3], 
                                             " **", 
                                             " ***")))
  }
}
```
`r if (knitr:::is_html_output()) '
# References {-}
'`


<!--chapter:end:report/references.Rmd-->

